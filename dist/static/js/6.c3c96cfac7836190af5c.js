webpackJsonp([6],{uTwX:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("mvHQ"),a=o.n(i),l=o("iPXC"),n=(o("G0J2"),o("yPE/"),o("mtWM")),s=o.n(n),c=(o("sfy8"),o("vLgD")),r={name:"Calc",data:function(){return{calcDialogName:"二次计算",calcDialog:!1,editorOption:{modules:{toolbar:{container:[["bold","italic"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["codeUpload"]],handlers:{codeUpload:function(){}}}},theme:"snow"},editorOption1:{modules:{toolbar:{container:[["bold","italic"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["editDuration"]],handlers:{editDuration:function(){}}}},theme:"snow"},calcContent:"",codeUploadDialogNames:"代码上传",codeUploadDialog:!1,jsCodeContent:"",codeFileList:[],tableData:[],actionUrl:"",uploadHeaders:{"Content-Type":"multipart/form-data"},limit:1,descriprionDialogNames:"添加描述",descriprionDialog:!1,description:"",condition:"",editDialogName:"编辑二次计算项",editDialog:!1,editContent:"",timeDurationDialogNames:"编辑计算项时间",timeDurationDialog:!1,timeDuration:"",selectedRow:null,editItems:[],size:"medium",owdith:"300"}},created:function(){document.body.clientWidth<768&&(this.size="mini",this.owdith="150"),this.actionUrl="http://"+Object(l.a)("ip")+"/page/uploadFile",this.render()},mounted:function(){document.querySelector(".el-main").style.backgroundColor=" #ffffff"},methods:{handleCalcOpen:function(){this.calcContent="",this.calcDialogName="新增二次计算项",this.calcDialog=!0},render:function(){var e,t=this;(e=a()({condition:"description like '%"+this.condition+"%'"}),Object(c.a)({url:"http://"+Object(l.a)("ip")+"/calculation/getCalcItem",method:"post",data:e})).then(function(e){var o=e.data;t.tableData=o.map(function(e){return"null"===e.updatedTime&&(e.updatedTime=""),e})})},handleCalcOpened:function(){var e=this,t=document.querySelector(".ql-codeUpload");t.classList="ql-codeUpload el-button el-button--text",t.innerText="代码上传",t.addEventListener("click",function(){e.codeUploadDialog=!0,e.codeFileList=[]}),document.querySelector(".ql-container").style.height="400px"},handleCalcOpened1:function(){var e=this,t=document.querySelector(".ql-editDuration");t.classList="ql-editDuration el-button el-button--text",t.innerText="编辑Item",this.editItems=[{label:"编辑描述",value:this.selectedRow.description},{label:"编辑计算时间",value:this.selectedRow.duration}],t.addEventListener("click",function(){e.timeDurationDialog=!0}),document.querySelector(".ql-container").style.height="400px"},calcHandler:function(){0===this.calcContent.length?this.$message.error("计算代码不能为空"):(this.descriprionDialog=!0,this.description="")},uploadCodeFile:function(){var e=this,t=new FormData,o=this.jsCodeContent;t.append("file",o),s()({headers:{"Content-Type":"multipart/form-data"},url:this.actionUrl,data:t,method:"post"}).then(function(){e.$message.success("上传成功")}).catch(function(t){var o=t.response.data.message;e.$notify.error({title:"上传失败",message:o})})},beforeCodeUpload:function(e){return this.jsCodeContent=e,!!this.isJs(this.jsCodeContent.name)||(this.$message.error("非法的文件类型或者文件列表已满!"),!1)},isJs:function(e){return/\.(js)$/.test(e)},showExceed:function(){this.$message.error("文件列表已满")},showJsCode:function(){var e=this;s.a.get("http://"+Object(l.a)("ip")+"/page/getJsCode/"+this.jsCodeContent.name).catch(function(t){var o=t.response.data.message;e.$notify.error({title:"加载二次计算js代码失败",message:o})}).then(function(t){var o=t.data;e.calcContent=o.data,e.codeUploadDialog=!1})},descriptionHandler:function(){var e,t=this;if(0===this.description.length)this.$message.error("计算项的描述不能为空");else{var o=this.$refs.edit.quill.getContents().ops.map(function(e){return e.insert}).join("");(e=a()({description:this.description,expression:o}),Object(c.a)({url:"http://"+Object(l.a)("ip")+"/calculation/addCalcItem",method:"post",data:e})).then(function(){t.descriprionDialog=!1,t.calcDialog=!1,t.$message.success("添加成功"),t.render()}).catch(function(e){var o=e.response.data.message;t.$notify.error({title:"添加失败",message:o})})}},startCalc:function(e){var t=this,o=e.id;s.a.get("http://"+Object(l.a)("ip")+"/calculation/startCalcItem/"+o).then(function(){t.$message.success("启动成功!"),t.render()}).catch(function(e){var o=e.response.data.message;t.$notify.error({title:"启动计算项失败",message:o})})},stopCalc:function(e){var t=this,o=e.id;s.a.get("http://"+Object(l.a)("ip")+"/calculation/stopCalcItem/"+o).then(function(){t.$message.success("成功停止计算项"),t.render()}).catch(function(e){var o=e.response.data.message;t.$notify.error({title:"启动计算项失败",message:o})})},deleteCalc:function(e){var t=this,o=e.id;s.a.get("http://"+Object(l.a)("ip")+"/calculation/deleteCalcItem/"+o).then(function(){t.$message.success("删除成功"),t.render()}).catch(function(e){var o=e.response.data.message;t.$notify.error({title:"删除失败",message:o})})},searchHandler:function(){this.render()},edit:function(e){this.selectedRow=e,this.editContent=e.expression.replace(/\n/g,"<br />"),this.editDialog=!0},timeHandler:function(){var e=parseFloat(this.editItems[1].value);60%e!=0?this.$message.error("计算间隔必须能被60整除"):e<1?this.$message.error("时间间隔不能小于1s"):this.timeDurationDialog=!1},updateCalcItem:function(){var e,t=this,o=this.$refs.edit1.quill.getContents().ops.map(function(e){return e.insert}).join(""),i=this.editItems[0].value,n=this.editItems[1].value;(e=a()({id:this.selectedRow.id,description:i,duration:n,expression:o}),Object(c.a)({url:"http://"+Object(l.a)("ip")+"/calculation/updateCalcItem",method:"post",data:e})).then(function(){t.editDialog=!1,t.render(),t.$message.success("更新成功")}).catch(function(e){var o=e.response.data.message;t.$notify.error({title:"更新失败",message:o})})}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-row"),e._v(" "),o("el-row",[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:e.size}},[o("el-table-column",{attrs:{type:"index",label:"index",width:"80",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"description",label:"description",align:"center",width:"180"}}),e._v(" "),o("el-table-column",{attrs:{prop:"expression",label:"expression","show-overflow-tooltip":"",align:"center",width:"800"}}),e._v(" "),o("el-table-column",{attrs:{prop:"duration",label:"duration",align:"center",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{prop:"status",label:"status",align:"center",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{prop:"errorMessage",label:"errorMessage",align:"center","show-overflow-tooltip":"",width:"150"}}),e._v(" "),o("el-table-column",{attrs:{prop:"createTime",label:"createTime",sortable:"",align:"center",width:"180"}}),e._v(" "),o("el-table-column",{attrs:{prop:"updatedTime",label:"updatedTime",align:"center",sortable:"",width:"180"}}),e._v(" "),o("el-table-column",{attrs:{width:e.owdith,fixed:"right",align:"center"},scopedSlots:e._u([{key:"header",fn:function(t){return[o("el-row",[o("el-col",{attrs:{span:10}},[o("el-button",{staticClass:"hidden-xs-only",attrs:{type:"text",size:e.size},on:{click:e.handleCalcOpen}},[e._v("新增计算项")])],1),e._v(" "),o("el-col",{attrs:{span:14}},[o("el-input",{staticClass:"hidden-xs-only",attrs:{placeholder:"根据description进行搜索"},on:{input:e.searchHandler},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}},[o("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1)]}},{key:"default",fn:function(t){return[o("el-button",{staticClass:"hidden-xs-only",attrs:{type:"text",size:e.size},on:{click:function(o){return e.edit(t.row)}}},[e._v("编辑")]),e._v(" "),"false"===t.row.status?o("el-button",{attrs:{type:"text",size:e.size},on:{click:function(o){return e.startCalc(t.row)}}},[e._v("启动")]):o("el-button",{attrs:{type:"text",size:e.size},on:{click:function(o){return e.stopCalc(t.row)}}},[e._v("停止")]),e._v(" "),o("el-button",{attrs:{type:"text",size:e.size},on:{click:function(o){return e.deleteCalc(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.calcDialogName,visible:e.calcDialog,width:"800px",showClose:!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.calcDialog=t},opened:e.handleCalcOpened}},[o("el-row",[o("quill-editor",{ref:"edit",attrs:{options:e.editorOption},model:{value:e.calcContent,callback:function(t){e.calcContent=t},expression:"calcContent"}})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.calcHandler}},[e._v("确定")]),e._v(" "),o("el-button",{on:{click:function(t){e.calcDialog=!1}}},[e._v("关闭")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.editDialogName,visible:e.editDialog,width:"800px",showClose:!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.editDialog=t},opened:e.handleCalcOpened1}},[o("el-row",[o("quill-editor",{ref:"edit1",attrs:{options:e.editorOption1},model:{value:e.editContent,callback:function(t){e.editContent=t},expression:"editContent"}})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.updateCalcItem}},[e._v("确定")]),e._v(" "),o("el-button",{on:{click:function(t){e.editDialog=!1}}},[e._v("关闭")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.codeUploadDialogNames,visible:e.codeUploadDialog,width:"800px",showClose:!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.codeUploadDialog=t}}},[o("el-upload",{attrs:{accept:".js",drag:"",action:e.actionUrl,multiple:"",headers:e.uploadHeaders,"http-request":e.uploadCodeFile,"before-upload":e.beforeCodeUpload,limit:e.limit,"file-list":e.codeFileList,"on-exceed":e.showExceed}},[o("i",{staticClass:"el-icon-upload"}),e._v(" "),o("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),o("em",[e._v("点击上传")])]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("可以上传js文件")])]),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.showJsCode}},[e._v("确定")]),e._v(" "),o("el-button",{on:{click:function(t){e.codeUploadDialog=!1}}},[e._v("关闭")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.descriprionDialogNames,visible:e.descriprionDialog,width:"550px",showClose:!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.descriprionDialog=t}}},[o("el-input",{attrs:{placeholder:"请输入计算项描述"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}}),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.descriptionHandler}},[e._v("确定")]),e._v(" "),o("el-button",{on:{click:function(t){e.descriprionDialog=!1}}},[e._v("关闭")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.timeDurationDialogNames,visible:e.timeDurationDialog,width:"550px",showClose:!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.timeDurationDialog=t}}},[o("el-form",{attrs:{"label-width":"100px"}},e._l(e.editItems,function(t,i){return o("el-form-item",{key:i,attrs:{label:t.label}},[o("el-input",{model:{value:t.value,callback:function(o){e.$set(t,"value",o)},expression:"item.value"}})],1)}),1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.timeHandler}},[e._v("确定")]),e._v(" "),o("el-button",{on:{click:function(t){e.timeDurationDialog=!1}}},[e._v("关闭")])],1)],1)],1)},staticRenderFns:[]},u=o("VU/8")(r,d,!1,null,null,null);t.default=u.exports}});